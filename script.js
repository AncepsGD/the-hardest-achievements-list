document.addEventListener("DOMContentLoaded",(()=>{const e=(n,a,s,i)=>{const o=document.createElement("div");o.classList.add("achievement-item");const r=n.id||`placeholder-${a}`;o.addEventListener("click",(a=>{const s=`/achievement/${r}`;a.ctrlKey||a.metaKey?window.open(s,"_blank"):0===a.button&&(a.preventDefault(),history.pushState(null,"",s),function(n){const a=document.getElementById("achievement-details");if(!a)return;a.innerHTML="";const s=document.createElement("div");s.classList.add("single-achievement-wrapper");const i=e(n,0,!1,[n]);s.appendChild(i),a.appendChild(s);const o=n.thumbnail||(n.levelID?`https://tjcsucht.net/levelthumbs/ ${n.levelID}.png`:"default-thumbnail.png");t(o),document.title=`${n.name} - The Hardest Achievements List`,document.getElementById("meta-description").setAttribute("content",`Details about the achievement "${n.name}" by ${n.player}`)}(n))}));const c=document.createElement("div");c.classList.add("rank-date-container");let l="N/A";if(s&&i){const e=i[a-1];l=e?((e,t)=>{if(!e||!t)return"N/A";const n=new Date(e),a=new Date(t),s=Math.abs(n-a);return Math.ceil(s/864e5)})(n.date,e.date):"N/A"}c.innerHTML=`\n            <div class="achievement-length">${n.length?`${Math.floor(n.length/60)}:${(n.length%60).toString().padStart(2,"0")}`:"N/A"}</div>\n            ${s?`<div class="lasted-days">Lasted ${l} days</div>`:`<div class="achievement-date">${new Date(n.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</div>`}\n            <div class="rank"><strong>${s?new Date(n.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):`#${a+1}`}</strong></div>\n        `;const d=document.createElement("div");d.classList.add("tag-container");const m={LEVEL:{color:"rgb(34, 139, 34)",text:"Level"},CHALLENGE:{color:"rgb(255, 165, 0)",text:"Challenge"},"LOW HERTZ":{color:"rgb(128, 0, 128)",text:"Low Hertz"},MOBILE:{color:"rgb(0, 191, 255)",text:"Mobile"},SPEEDHACK:{color:"rgb(255, 69, 0)",text:"Speedhack"},NOCLIP:{color:"rgb(139, 0, 0)",text:"Noclip"},MISCELLANEOUS:{color:"rgb(105, 105, 105)",text:"Miscellaneous"},PROGRESS:{color:"rgb(70, 130, 180)",text:"Progress"},CONSISTENCY:{color:"rgb(75, 0, 130)",text:"Consistency"},"2P":{color:"rgb(230, 115, 39)",icon:"/assets/2p-icon.png",text:"2 Player"},CBF:{color:"rgb(219, 48, 63)",icon:"/assets/cbf-logo.png",text:"CBF"},RATED:{color:"rgb(230, 184, 60)",icon:"/assets/rated-icon.png",text:"Rated"},"FORMERLY RATED":{color:"rgb(131, 51, 37)",icon:"/assets/formerly-rated-icon.png",text:"Formerly Rated"},"OUTDATED VERSION":{color:"rgb(110, 103, 33)",icon:"/assets/outdated-version-icon.png",text:"Outdated Version"}},h=["LEVEL","CHALLENGE","LOW HERTZ","MOBILE","SPEEDHACK","NOCLIP","MISCELLANEOUS","PROGRESS","CONSISTENCY","2P","CBF","RATED","FORMERLY RATED","OUTDATED VERSION"];(n.tags||[]).sort(((e,t)=>h.indexOf(e.toUpperCase())-h.indexOf(t.toUpperCase()))).forEach((e=>{const t=m[e.toUpperCase()];if(t){const e=document.createElement("div");e.classList.add("tag"),e.style.backgroundColor=t.color,e.innerHTML=`\n                        ${t.icon?`<img src="${t.icon}" alt="${t.text} Icon" class="tag-icon">`:""}\n                        <span>${t.text}</span>\n                    `,d.appendChild(e)}}));const u=document.createElement("div");return u.classList.add("achievement-details"),u.innerHTML=`\n            <div class="text">\n                <h2>${n.name}</h2>\n                <p>${n.player}</p>\n            </div>\n            <div class="thumbnail-container">\n                <img data-src="${(e=>e.thumbnail||(e.levelID?`https://tjcsucht.net/levelthumbs/${e.levelID}.png`:"default-thumbnail.png"))(n)}" loading="lazy">\n            </div>\n        `,o.append(c,d,u),o},t=e=>{const t=document.getElementById("dynamic-background");t&&(t.hasAttribute("data-achievement-bg")||(t.style.backgroundImage=`url(${e})`))};const n=(n,a,s=!1)=>{fetch(a).then((e=>e.json())).then((a=>{if(a.length>0){const e=a[0],n=e.thumbnail||(e.levelID?`https://tjcsucht.net/levelthumbs/${e.levelID}.png`:"default-thumbnail.png");t(n)}const i=document.getElementById("achievements-container"),o=new Set;a.forEach((e=>(e.tags||[]).forEach((e=>o.add(e)))));const r=["LEVEL","CHALLENGE","LOW HERTZ","MOBILE","SPEEDHACK","NOCLIP","MISCELLANEOUS","PROGRESS","CONSISTENCY","2P","CBF","RATED","FORMERLY RATED","OUTDATED VERSION"],c=Array.from(o).sort(((e,t)=>{const n=r.indexOf(e.toUpperCase()),a=r.indexOf(t.toUpperCase());return-1===n&&-1===a?e.localeCompare(t):-1===n?1:-1===a?-1:n-a})),l=document.getElementById("search-filter-static-container");let d=document.querySelector(".search-filter-container");if(l&&!d){const{filterContainer:e}=function(e,t){const n=document.createElement("div");n.className="search-filter-container";const a=document.createElement("div");a.className="tag-filter-pills",a.setAttribute("tabindex","0");const s={};t.forEach((e=>s[e]="neutral")),t.forEach((t=>{const n=document.createElement("span");n.className="tag-filter-pill neutral",n.textContent=t,n.setAttribute("tabindex","0"),n.setAttribute("data-tag",t),n.setAttribute("aria-label",`${t} filter pill`),n.addEventListener("click",(()=>{"neutral"===s[t]?s[t]="include":"include"===s[t]?s[t]="exclude":s[t]="neutral",function(e,t){e.classList.remove("neutral","include","exclude"),e.classList.add(t)}(n,s[t]),e()})),n.addEventListener("keydown",(e=>{" "!==e.key&&"Enter"!==e.key||(n.click(),e.preventDefault())})),a.appendChild(n)})),n.appendChild(a),n.getTagFilterState=()=>{const e=[],t=[];for(const n in s)"include"===s[n]&&e.push(n),"exclude"===s[n]&&t.push(n);return{include:e,exclude:t}};const i=document.getElementById("mobile-filter-toggle-btn");if(i){const e=document.querySelector("header");e&&e.appendChild(i)}function o(){window.innerWidth<=900?(i&&(i.style.display=""),a.style.display=n.classList.contains("mobile-filters-shown")?"":"none",n.classList.contains("mobile-filters-shown")?i&&(i.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-up.svg" alt="Hide Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>'):i&&(i.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-down.svg" alt="Show Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>')):(i&&(i.style.display="none"),a.style.display="",n.classList.remove("mobile-filters-shown"),i&&(i.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-down.svg" alt="Show Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>'))}return i&&i.addEventListener("click",(()=>{n.classList.toggle("mobile-filters-shown"),o()})),window.addEventListener("resize",o),o(),{filterContainer:n}}((()=>u()),c);l.appendChild(e),d=e}let m="default",h="";function u(){const o=document.getElementById("search-filter-select");o&&(m=o.value);const{include:r,exclude:c}=d&&"function"==typeof d.getTagFilterState?d.getTagFilterState():{include:[],exclude:[]},l=function(e,t){switch(t){case"length":return[...e].sort(((e,t)=>(t.length||0)-(e.length||0)));case"alphabetical":return[...e].sort(((e,t)=>(e.name||"").localeCompare(t.name||"",void 0,{sensitivity:"base"})));case"date":return[...e].sort(((e,t)=>new Date(t.date)-new Date(e.date)));case"version":return[...e].sort(((e,t)=>(e.version||"").localeCompare(t.version||"",void 0,{numeric:!0,sensitivity:"base"})));case"levelid":return[...e].sort(((e,t)=>(e.levelID||0)-(t.levelID||0)));default:return n(e)}}(a,m).filter((e=>{const t="string"==typeof e.name?e.name:"",n=(e.tags||[]).map((e=>e.toUpperCase()));return!(r.length&&!r.every((e=>n.includes(e.toUpperCase()))))&&((!c.length||!c.some((e=>n.includes(e.toUpperCase()))))&&t.toLowerCase().includes(h))}));i.innerHTML="";const u=document.createDocumentFragment();if(l.forEach(((t,n)=>{u.appendChild(e(t,n,s,l))})),i.appendChild(u),function(){const e=document.querySelectorAll(".achievement-item .thumbnail-container img[data-src]");if("IntersectionObserver"in window){const t=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n)}}))}),{rootMargin:"100px"});e.forEach((e=>t.observe(e)))}else e.forEach((e=>{e.src=e.dataset.src,e.removeAttribute("data-src")}))}(),!s&&l.length>0){const e=l[0].thumbnail||(l[0].levelID?`https://tjcsucht.net/levelthumbs/${l[0].levelID}.png`:"default-thumbnail.png");t(e)}}u();const p=document.querySelector(".search-bar input"),v=((e,t)=>{let n;return(...a)=>{clearTimeout(n),n=setTimeout((()=>e(...a)),t)}})((e=>{h=e.target.value.toLowerCase(),u()}),250);p.addEventListener("input",v)}))},a=e=>e,s=e=>e.sort(((e,t)=>new Date(t.date)-new Date(e.date)));function i(){const e=o(window.location.href),t=document.querySelectorAll(".sidebar-link");let n=!1;for(const a of t){const t=a.getAttribute("href");if(!t||"#"===t)continue;const s=o(t);a.classList.remove("active"),s!==e||n||(a.classList.add("active"),n=!0)}}function o(e){try{const t=new URL(e,window.location.href).pathname;return t.slice(t.lastIndexOf("/")+1).toLowerCase()}catch(t){const n=e.split(/[?#]/)[0];return n.slice(n.lastIndexOf("/")+1).toLowerCase()}}function r(){const e=document.getElementById("mobile-hamburger-btn"),t=document.getElementById("sidebar");let n=document.getElementById("sidebar-mobile-overlay");function a(){t.classList.remove("sidebar-mobile-open"),n.classList.add("hidden")}t&&e&&(n||(n=document.createElement("div"),n.id="sidebar-mobile-overlay",n.className="sidebar-mobile-overlay hidden",document.body.appendChild(n)),e.addEventListener("click",(e=>{e.stopPropagation(),t.classList.add("sidebar-mobile-open"),n.classList.remove("hidden")})),n.addEventListener("click",a),document.addEventListener("keydown",(e=>{"Escape"===e.key&&a()})),t.addEventListener("click",(e=>{t.classList.contains("sidebar-mobile-open")&&e.stopPropagation()})))}window.location.pathname.includes("timeline.html")?n(s,"timeline.json",!0):n(a,"achievements.json"),fetch("assets/sidebar.html").then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.text()})).then((e=>{const t=document.getElementById("sidebar");if(t){t.innerHTML=e;t.querySelectorAll(".sidebar-link.active").forEach((e=>e.classList.remove("active"))),requestAnimationFrame((()=>{i(),function(){const e=document.getElementById("random-achievement-btn");if(!e)return;fetch("achievements.json").then((e=>e.json())).then((t=>{const n=t.filter((e=>e&&e.id));e.addEventListener("click",(e=>{if(e.preventDefault(),n.length>0){const e=n[Math.floor(Math.random()*n.length)];window.location.href=`/achievement/${e.id}`}}))})).catch((e=>console.error("Failed to load achievements:",e)))}()}))}})).catch((e=>{console.error("Error loading sidebar:",e)})),r(),window.addEventListener("pageshow",(e=>{e.persisted&&(r(),i())})),window.addEventListener("pagehide",(e=>{}));const c=window.location.pathname;if(c.startsWith("/achievement/")){const n=decodeURIComponent(c.split("/achievement/")[1].toLowerCase());fetch("achievements.json").then((e=>e.json())).then((a=>{const s=a.find((e=>e.id&&e.id.toLowerCase()===n));if(s){document.getElementById("achievements-container").style.display="none";let n=document.getElementById("achievement-details");n||(n=document.createElement("section"),n.id="achievement-details",n.className="achievement-details-container",document.querySelector(".main-content").appendChild(n));const a=document.createElement("div");a.classList.add("single-achievement-wrapper");const i=e(s,0,!1,[s]);a.appendChild(i),n.innerHTML="",n.appendChild(a);const o=s.thumbnail||(s.levelID?`https://tjcsucht.net/levelthumbs/ ${s.levelID}.png`:"default-thumbnail.png");t(o),document.title=`${s.name} - The Hardest Achievements List`,document.getElementById("meta-description").setAttribute("content",`Details about the achievement "${s.name}" by ${s.player}`)}else{const e=document.getElementById("achievement-details")||document.getElementById("achievements-container");e&&(e.innerHTML=`\n                        <div class="not-found">\n                            <h2>Achievement Not Found</h2>\n                            <p>We couldn't find an achievement with the ID: <strong>${n}</strong></p>\n                            <a href="/" class="btn btn-primary">Return to Home</a>\n                        </div>\n                    `)}})).catch((e=>{console.error("Failed to load achievements.json:",e);const t=document.getElementById("achievement-details")||document.getElementById("achievements-container");t&&(t.innerHTML='\n                    <div class="error">\n                        <h2>Error Loading Achievement</h2>\n                        <p>There was a problem loading the achievement data.</p>\n                        <a href="/" class="btn btn-secondary">Back to Home</a>\n                    </div>\n                ')}))}}));
