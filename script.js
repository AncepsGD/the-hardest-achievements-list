document.addEventListener("DOMContentLoaded",()=>{let e={LEVEL:{color:"rgb(34, 139, 34)",text:"Level"},CHALLENGE:{color:"rgb(255, 165, 0)",text:"Challenge"},"LOW HERTZ":{color:"rgb(128, 0, 128)",text:"Low Hertz"},MOBILE:{color:"rgb(0, 191, 255)",text:"Mobile"},SPEEDHACK:{color:"rgb(255, 69, 0)",text:"Speedhack"},NOCLIP:{color:"rgb(139, 0, 0)",text:"Noclip"},MISCELLANEOUS:{color:"rgb(105, 105, 105)",text:"Miscellaneous"},PROGRESS:{color:"rgb(70, 130, 180)",text:"Progress"},CONSISTENCY:{color:"rgb(75, 0, 130)",text:"Consistency"},"2P":{color:"rgb(230, 115, 39)",icon:"/assets/2p-icon.png",text:"2 Player"},CBF:{color:"rgb(219, 48, 63)",icon:"/assets/cbf-logo.png",text:"CBF"},RATED:{color:"rgb(230, 184, 60)",icon:"/assets/rated-icon.png",text:"Rated"},"FORMERLY RATED":{color:"rgb(131, 51, 37)",icon:"/assets/formerly-rated-icon.png",text:"Formerly Rated"},"OUTDATED VERSION":{color:"rgb(110, 103, 33)",icon:"/assets/outdated-version-icon.png",text:"Outdated Version"}},t=["LEVEL","CHALLENGE","LOW HERTZ","MOBILE","SPEEDHACK","NOCLIP","MISCELLANEOUS","PROGRESS","CONSISTENCY","2P","CBF","RATED","FORMERLY RATED","OUTDATED VERSION"];function n(e){return e.thumbnail||(e.levelID?`https://tjcsucht.net/levelthumbs/${e.levelID}.png`:"default-thumbnail.png")}function i(e,t){if(!e||!t)return"N/A";let n=new Date(e),i=new Date(t);return Math.ceil(Math.abs(n-i)/864e5)}function a(){let e=document.querySelectorAll(".achievement-item .thumbnail-container img[data-src]");if("IntersectionObserver"in window){let t=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){let n=e.target;n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n)}})},{rootMargin:"100px"});e.forEach(e=>t.observe(e))}else e.forEach(e=>{e.src=e.dataset.src,e.removeAttribute("data-src")})}function l(n){let i=document.createElement("div");return i.classList.add("tag-container"),(n.tags||[]).sort((e,n)=>t.indexOf(e.toUpperCase())-t.indexOf(n.toUpperCase())).forEach(t=>{let n=e[t.toUpperCase()];if(n){let a=document.createElement("div");a.classList.add("tag"),a.style.backgroundColor=n.color,a.innerHTML=`
                        ${n.icon?`<img src="${n.icon}" alt="${n.text} Icon" class="tag-icon">`:""}
                        <span>${n.text}</span>
                    `,i.appendChild(a)}}),i}function r(e){let t=document.getElementById("dynamic-background");t&&!t.hasAttribute("data-achievement-bg")&&(t.style.backgroundImage=`url(${e})`)}function s(e,t,a,r){let s=document.createElement("div");s.classList.add("achievement-item");let o=e.id||`placeholder-${t}`;s.addEventListener("click",t=>{let n=`/achievement/${o}`;t.ctrlKey||t.metaKey?window.open(n,"_blank"):0===t.button&&(t.preventDefault(),history.pushState(null,"",n),b(e))});let c=document.createElement("div");c.classList.add("rank-date-container");let d="N/A";if(a&&r){let h=r[t-1];d=h?i(e.date,h.date):"N/A"}c.innerHTML=`
            <div class="achievement-length">${e.length?`${Math.floor(e.length/60)}:${(e.length%60).toString().padStart(2,"0")}`:"N/A"}</div>
            ${a?`<div class="lasted-days">Lasted ${d} days</div>`:`<div class="achievement-date">${new Date(e.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</div>`}
            <div class="rank"><strong>${a?new Date(e.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):`#${t+1}`}</strong></div>
        `;let m=l(e),p=document.createElement("div");return p.classList.add("achievement-details"),p.innerHTML=`
            <div class="text">
                <h2>${e.name}</h2>
                <p>${e.player}</p>
            </div>
            <div class="thumbnail-container">
                <img data-src="${n(e)}" loading="lazy">
            </div>
        `,s.append(c,m,p),s}function o(e,t){let n=document.createElement("div");n.className="search-filter-container";let i=document.createElement("div");i.className="tag-filter-pills",i.setAttribute("tabindex","0");let a={};t.forEach(e=>a[e]="neutral"),t.forEach(t=>{let n=document.createElement("span");n.className="tag-filter-pill neutral",n.textContent=t,n.setAttribute("tabindex","0"),n.setAttribute("data-tag",t),n.setAttribute("aria-label",`${t} filter pill`),n.addEventListener("click",()=>{var i,l;"neutral"===a[t]?a[t]="include":"include"===a[t]?a[t]="exclude":a[t]="neutral",i=n,l=a[t],i.classList.remove("neutral","include","exclude"),i.classList.add(l),e()}),n.addEventListener("keydown",e=>{(" "===e.key||"Enter"===e.key)&&(n.click(),e.preventDefault())}),i.appendChild(n)}),n.appendChild(i),n.getTagFilterState=()=>{let e=[],t=[];for(let n in a)"include"===a[n]&&e.push(n),"exclude"===a[n]&&t.push(n);return{include:e,exclude:t}};let l=document.getElementById("mobile-filter-toggle-btn");if(l){let r=document.querySelector("header");r&&r.appendChild(l)}function s(){window.innerWidth<=900?(l&&(l.style.display=""),i.style.display=n.classList.contains("mobile-filters-shown")?"":"none",n.classList.contains("mobile-filters-shown")?l&&(l.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-up.svg" alt="Hide Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>'):l&&(l.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-down.svg" alt="Show Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>')):(l&&(l.style.display="none"),i.style.display="",n.classList.remove("mobile-filters-shown"),l&&(l.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-down.svg" alt="Show Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>'))}return l&&l.addEventListener("click",()=>{n.classList.toggle("mobile-filters-shown"),s()}),window.addEventListener("resize",s),s(),{filterContainer:n}}let c=(e,t,n=!1)=>{fetch(t).then(e=>e.json()).then(e=>{if(0===(e=e.filter(e=>e&&e.name&&e.id&&e.date)).length){let i=document.getElementById("achievements-container");i&&(i.innerHTML='<div class="no-achievements">No achievements to display. Please check the timeline data.</div>'),console.warn("No valid achievements found in",t);return}if(e.length>0){let l=e[0].thumbnail||(e[0].levelID?`https://tjcsucht.net/levelthumbs/${e[0].levelID}.png`:"default-thumbnail.png");r(l)}let c=document.getElementById("achievements-container");if(!c)return;let d=new Set;for(let h=0;h<e.length;++h){let m=e[h].tags||[];for(let p=0;p<m.length;++p)d.add(m[p])}let u=["LEVEL","CHALLENGE","LOW HERTZ","MOBILE","SPEEDHACK","NOCLIP","MISCELLANEOUS","PROGRESS","CONSISTENCY","2P","CBF","RATED","FORMERLY RATED","OUTDATED VERSION"],v=Array.from(d).sort((e,t)=>{let n=u.indexOf(e.toUpperCase()),i=u.indexOf(t.toUpperCase());return -1===n&&-1===i?e.localeCompare(t):-1===n?1:-1===i?-1:n-i}),g=document.getElementById("search-filter-static-container"),E=document.querySelector(".search-filter-container");if(g&&!E){let{filterContainer:f}=o(C,v);g.appendChild(f)}let b="default",L="";function y(){let e=document.querySelector(".search-filter-container");return e&&"function"==typeof e.getTagFilterState?e.getTagFilterState():{include:[],exclude:[]}}function $(e,t){return"date"===t?[...e].sort((e,t)=>new Date(t.date)-new Date(e.date)):e}function C(){let t=document.getElementById("search-filter-select");t&&(b=t.value);let{include:i,exclude:l}=y(),o=$(e,b).filter(e=>{let t="string"==typeof e.name?e.name:"",n=(e.tags||[]).map(e=>e.toUpperCase());return!(i.length&&!i.every(e=>n.includes(e.toUpperCase()))||l.length&&l.some(e=>n.includes(e.toUpperCase())))&&t.toLowerCase().includes(L)});if(c.innerHTML="",0===o.length)return;let d=document.createDocumentFragment();for(let h=0;h<o.length;++h)d.appendChild(s(o[h],h,n,o));if(c.appendChild(d),a(),!n&&o.length>0){let m=o[0].thumbnail||(o[0].levelID?`https://tjcsucht.net/levelthumbs/${o[0].levelID}.png`:"default-thumbnail.png");r(m)}}C();let _=document.querySelector(".search-bar input");if(_&&!_._debounced){let S=debounceFunction(e=>{L=e.target.value.toLowerCase(),C()},250);_.addEventListener("input",S),_._debounced=!0}})},d=e=>e.sort((e,t)=>new Date(t.date)-new Date(e.date));function h(){let e=document.getElementById("achievements-container");if(!e){let t=document.querySelector("main.main-content")||document.querySelector("main");t&&((e=document.createElement("section")).className="achievements",e.id="achievements-container",t.appendChild(e))}return e}function m({sortFunction:e,jsonFilePath:t,isTimeline:n}){h(),c(e,t,n)}function p(){let e=u(window.location.href),t=document.querySelectorAll(".sidebar-link"),n=!1;for(let i of t){let a=i.getAttribute("href");if(!a||"#"===a)continue;let l=u(a);i.classList.remove("active"),l!==e||n||(i.classList.add("active"),n=!0)}}function u(e){try{let t=new URL(e,window.location.href),n=t.pathname;return n.slice(n.lastIndexOf("/")+1).toLowerCase()}catch(i){let a=e.split(/[?#]/)[0];return a.slice(a.lastIndexOf("/")+1).toLowerCase()}}function v(){let e=document.getElementById("random-achievement-btn");e&&(v.achievementsPromise||(v.achievementsPromise=fetch("achievements.json").then(e=>e.json()).then(e=>e.filter(e=>e&&e.id))),v.achievementsPromise.then(t=>{e.addEventListener("click",e=>{if(!t.length)return;let n=t[Math.floor(Math.random()*t.length)];n&&n.id&&(window.location.href=`/achievement/${n.id}`)})}).catch(e=>console.error("Failed to load achievements:",e)))}function g(){let e=document.getElementById("mobile-hamburger-btn"),t=document.getElementById("sidebar"),n=document.getElementById("sidebar-mobile-overlay");function i(){t.classList.remove("sidebar-mobile-open"),n.classList.add("hidden")}t&&e&&(n||((n=document.createElement("div")).id="sidebar-mobile-overlay",n.className="sidebar-mobile-overlay hidden",document.body.appendChild(n)),e.addEventListener("click",e=>{e.stopPropagation(),t.classList.add("sidebar-mobile-open"),n.classList.remove("hidden")}),n.addEventListener("click",i),document.addEventListener("keydown",e=>{"Escape"===e.key&&i()}),t.addEventListener("click",e=>{t.classList.contains("sidebar-mobile-open")&&e.stopPropagation()}))}window.location.pathname.endsWith("/timeline")||window.location.pathname.endsWith("/timeline.html")?m({sortFunction:d,jsonFilePath:"timeline.json",isTimeline:!0}):(window.location.pathname.endsWith("/list")||window.location.pathname.endsWith("/index")||window.location.pathname.endsWith("/index.html"))&&m({sortFunction:e=>e,jsonFilePath:"achievements.json",isTimeline:!1}),fetch("assets/sidebar.html").then(e=>{if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return e.text()}).then(e=>{let t=document.getElementById("sidebar");if(t){t.innerHTML=e;let n=t.querySelectorAll(".sidebar-link.active");n.forEach(e=>e.classList.remove("active")),requestAnimationFrame(()=>{p()})}}).catch(e=>{console.error("Error loading sidebar:",e)}),v(),g(),window.addEventListener("pageshow",e=>{e.persisted&&(g(),p())}),window.addEventListener("pagehide",e=>{});let E=window.location.pathname;if(E.startsWith("/achievement/")){let f=decodeURIComponent(E.split("/achievement/")[1].toLowerCase());fetch("achievements.json").then(e=>e.json()).then(e=>{let t=e.find(e=>e.id&&e.id.toLowerCase()===f);if(t)b(t);else{let n=document.getElementById("achievement-details")||document.querySelector(".main-content");n&&(n.innerHTML='<div class="no-achievements">Achievement not found.</div>')}}).catch(e=>{console.error("Failed to load achievements.json:",e);let t=document.getElementById("achievement-details")||document.querySelector(".main-content");t&&(t.innerHTML='<div class="no-achievements">Failed to load achievement data.</div>')})}function b(e){let t=document.querySelector(".main-content"),n=document.getElementById("achievement-details");n?n.innerHTML="":((n=document.createElement("section")).id="achievement-details",n.className="achievement-details-container",t&&(t.innerHTML="",t.appendChild(n)));let i=document.createElement("div");i.classList.add("single-achievement-wrapper");let a=s(e,0,!1,[e]);i.appendChild(a),n.appendChild(i);let l=e.thumbnail||(e.levelID?`https://tjcsucht.net/levelthumbs/${e.levelID}.png`:"default-thumbnail.png");r(l),document.title=`${e.name} - The Hardest Achievements List`;let o=document.getElementById("meta-description");o&&o.setAttribute("content",`Details about the achievement "${e.name}" by ${e.player}`)}});
