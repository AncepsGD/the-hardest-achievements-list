document.addEventListener("DOMContentLoaded",()=>{let e=(e,t)=>{let n;return(...a)=>{clearTimeout(n),n=setTimeout(()=>e(...a),t)}},t=e=>e.thumbnail||(e.levelID?`https://tjcsucht.net/levelthumbs/${e.levelID}.png`:"default-thumbnail.png"),n=(e,t)=>{if(!e||!t)return"N/A";let n=new Date(e),a=new Date(t),i=Math.abs(n-a);return Math.ceil(i/864e5)};function a(){let e=document.querySelectorAll(".achievement-item .thumbnail-container img[data-src]");if("IntersectionObserver"in window){let t=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){let n=e.target;n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n)}})},{rootMargin:"100px"});e.forEach(e=>t.observe(e))}else e.forEach(e=>{e.src=e.dataset.src,e.removeAttribute("data-src")})}let i=(e,a,i,l)=>{let r=document.createElement("div");r.classList.add("achievement-item");let s=e.id||`placeholder-${a}`;r.addEventListener("click",t=>{let n=`/achievement/${s}`;t.ctrlKey||t.metaKey?window.open(n,"_blank"):0===t.button&&(t.preventDefault(),history.pushState(null,"",n),v(e))});let o=document.createElement("div");o.classList.add("rank-date-container");let c="N/A";if(i&&l){let d=l[a-1];c=d?n(e.date,d.date):"N/A"}o.innerHTML=`
            <div class="achievement-length">${e.length?`${Math.floor(e.length/60)}:${(e.length%60).toString().padStart(2,"0")}`:"N/A"}</div>
            ${i?`<div class="lasted-days">Lasted ${c} days</div>`:`<div class="achievement-date">${new Date(e.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</div>`}
            <div class="rank"><strong>${i?new Date(e.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):`#${a+1}`}</strong></div>
        `;let h=document.createElement("div");h.classList.add("tag-container");let m={LEVEL:{color:"rgb(34, 139, 34)",text:"Level"},CHALLENGE:{color:"rgb(255, 165, 0)",text:"Challenge"},"LOW HERTZ":{color:"rgb(128, 0, 128)",text:"Low Hertz"},MOBILE:{color:"rgb(0, 191, 255)",text:"Mobile"},SPEEDHACK:{color:"rgb(255, 69, 0)",text:"Speedhack"},NOCLIP:{color:"rgb(139, 0, 0)",text:"Noclip"},MISCELLANEOUS:{color:"rgb(105, 105, 105)",text:"Miscellaneous"},PROGRESS:{color:"rgb(70, 130, 180)",text:"Progress"},CONSISTENCY:{color:"rgb(75, 0, 130)",text:"Consistency"},"2P":{color:"rgb(230, 115, 39)",icon:"/assets/2p-icon.png",text:"2 Player"},CBF:{color:"rgb(219, 48, 63)",icon:"/assets/cbf-logo.png",text:"CBF"},RATED:{color:"rgb(230, 184, 60)",icon:"/assets/rated-icon.png",text:"Rated"},"FORMERLY RATED":{color:"rgb(131, 51, 37)",icon:"/assets/formerly-rated-icon.png",text:"Formerly Rated"},"OUTDATED VERSION":{color:"rgb(110, 103, 33)",icon:"/assets/outdated-version-icon.png",text:"Outdated Version"}},p=["LEVEL","CHALLENGE","LOW HERTZ","MOBILE","SPEEDHACK","NOCLIP","MISCELLANEOUS","PROGRESS","CONSISTENCY","2P","CBF","RATED","FORMERLY RATED","OUTDATED VERSION"];(e.tags||[]).sort((e,t)=>p.indexOf(e.toUpperCase())-p.indexOf(t.toUpperCase())).forEach(e=>{let t=m[e.toUpperCase()];if(t){let n=document.createElement("div");n.classList.add("tag"),n.style.backgroundColor=t.color,n.innerHTML=`
                        ${t.icon?`<img src="${t.icon}" alt="${t.text} Icon" class="tag-icon">`:""}
                        <span>${t.text}</span>
                    `,h.appendChild(n)}});let u=document.createElement("div");return u.classList.add("achievement-details"),u.innerHTML=`
            <div class="text">
                <h2>${e.name}</h2>
                <p>${e.player}</p>
            </div>
            <div class="thumbnail-container">
                <img data-src="${t(e)}" loading="lazy">
            </div>
        `,r.append(o,h,u),r},l=e=>{let t=document.getElementById("dynamic-background");t&&!t.hasAttribute("data-achievement-bg")&&(t.style.backgroundImage=`url(${e})`)};function r(e,t){let n=document.createElement("div");n.className="search-filter-container";let a=document.createElement("div");a.className="tag-filter-pills",a.setAttribute("tabindex","0");let i={};t.forEach(e=>i[e]="neutral"),t.forEach(t=>{let n=document.createElement("span");n.className="tag-filter-pill neutral",n.textContent=t,n.setAttribute("tabindex","0"),n.setAttribute("data-tag",t),n.setAttribute("aria-label",`${t} filter pill`),n.addEventListener("click",()=>{var a,l;"neutral"===i[t]?i[t]="include":"include"===i[t]?i[t]="exclude":i[t]="neutral",a=n,l=i[t],a.classList.remove("neutral","include","exclude"),a.classList.add(l),e()}),n.addEventListener("keydown",e=>{(" "===e.key||"Enter"===e.key)&&(n.click(),e.preventDefault())}),a.appendChild(n)}),n.appendChild(a),n.getTagFilterState=()=>{let e=[],t=[];for(let n in i)"include"===i[n]&&e.push(n),"exclude"===i[n]&&t.push(n);return{include:e,exclude:t}};let l=document.getElementById("mobile-filter-toggle-btn");if(l){let r=document.querySelector("header");r&&r.appendChild(l)}function s(){window.innerWidth<=900?(l&&(l.style.display=""),a.style.display=n.classList.contains("mobile-filters-shown")?"":"none",n.classList.contains("mobile-filters-shown")?l&&(l.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-up.svg" alt="Hide Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>'):l&&(l.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-down.svg" alt="Show Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>')):(l&&(l.style.display="none"),a.style.display="",n.classList.remove("mobile-filters-shown"),l&&(l.innerHTML='<span class="arrow-img-wrapper"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/chevron-down.svg" alt="Show Filters" style="width: 20px; height: 20px; filter: invert(92%) sepia(7%) saturate(104%) hue-rotate(200deg) brightness(97%) contrast(92%);"></span>'))}return l&&l.addEventListener("click",()=>{n.classList.toggle("mobile-filters-shown"),s()}),window.addEventListener("resize",s),s(),{filterContainer:n}}let s=(t,n,s=!1)=>{fetch(n).then(e=>e.json()).then(n=>{if(n.length>0){let o=n[0],c=o.thumbnail||(o.levelID?`https://tjcsucht.net/levelthumbs/${o.levelID}.png`:"default-thumbnail.png");l(c)}let d=document.getElementById("achievements-container");if(!d)return;let h=new Set;n.forEach(e=>(e.tags||[]).forEach(e=>h.add(e)));let m=["LEVEL","CHALLENGE","LOW HERTZ","MOBILE","SPEEDHACK","NOCLIP","MISCELLANEOUS","PROGRESS","CONSISTENCY","2P","CBF","RATED","FORMERLY RATED","OUTDATED VERSION"],p=Array.from(h).sort((e,t)=>{let n=m.indexOf(e.toUpperCase()),a=m.indexOf(t.toUpperCase());return -1===n&&-1===a?e.localeCompare(t):-1===n?1:-1===a?-1:n-a}),u=document.getElementById("search-filter-static-container"),v=document.querySelector(".search-filter-container");if(u&&!v){let{filterContainer:g}=r(()=>y(),p);u.appendChild(g),v=g}let E="default",b="";function f(){return v&&"function"==typeof v.getTagFilterState?v.getTagFilterState():{include:[],exclude:[]}}function L(e,n){switch(n){case"length":return[...e].sort((e,t)=>(t.length||0)-(e.length||0));case"alphabetical":return[...e].sort((e,t)=>(e.name||"").localeCompare(t.name||"",void 0,{sensitivity:"base"}));case"date":return[...e].sort((e,t)=>new Date(t.date)-new Date(e.date));case"version":return[...e].sort((e,t)=>(e.version||"").localeCompare(t.version||"",void 0,{numeric:!0,sensitivity:"base"}));case"levelid":return[...e].sort((e,t)=>(e.levelID||0)-(t.levelID||0));default:return t(e)}}function y(){let e=document.getElementById("search-filter-select");e&&(E=e.value);let{include:t,exclude:r}=f(),o=L(n,E).filter(e=>{let n="string"==typeof e.name?e.name:"",a=(e.tags||[]).map(e=>e.toUpperCase());return!(t.length&&!t.every(e=>a.includes(e.toUpperCase()))||r.length&&r.some(e=>a.includes(e.toUpperCase())))&&n.toLowerCase().includes(b)});d.innerHTML="";let c=document.createDocumentFragment();for(let h=0;h<o.length;++h)c.appendChild(i(o[h],h,s,o));if(d.appendChild(c),a(),!s&&o.length>0){let m=o[0].thumbnail||(o[0].levelID?`https://tjcsucht.net/levelthumbs/${o[0].levelID}.png`:"default-thumbnail.png");l(m)}}y();let $=document.querySelector(".search-bar input");if($){let C=e(e=>{b=e.target.value.toLowerCase(),y()},250);$.addEventListener("input",C)}})},o=e=>e.sort((e,t)=>new Date(t.date)-new Date(e.date));function c(){let e=d(window.location.href),t=document.querySelectorAll(".sidebar-link"),n=!1;for(let a of t){let i=a.getAttribute("href");if(!i||"#"===i)continue;let l=d(i);a.classList.remove("active"),l!==e||n||(a.classList.add("active"),n=!0)}}function d(e){try{let t=new URL(e,window.location.href),n=t.pathname;return n.slice(n.lastIndexOf("/")+1).toLowerCase()}catch(a){let i=e.split(/[?#]/)[0];return i.slice(i.lastIndexOf("/")+1).toLowerCase()}}function h(){let e=document.getElementById("random-achievement-btn");e&&(h.achievementsPromise||(h.achievementsPromise=fetch("achievements.json").then(e=>e.json()).then(e=>e.filter(e=>e&&e.id))),h.achievementsPromise.then(t=>{e.addEventListener("click",e=>{if(e.preventDefault(),t.length>0){let n=t[Math.floor(Math.random()*t.length)];window.location.href=`/achievement/${n.id}`}})}).catch(e=>console.error("Failed to load achievements:",e)))}function m(){let e=document.getElementById("mobile-hamburger-btn"),t=document.getElementById("sidebar"),n=document.getElementById("sidebar-mobile-overlay");function a(){t.classList.remove("sidebar-mobile-open"),n.classList.add("hidden")}t&&e&&(n||((n=document.createElement("div")).id="sidebar-mobile-overlay",n.className="sidebar-mobile-overlay hidden",document.body.appendChild(n)),e.addEventListener("click",e=>{e.stopPropagation(),t.classList.add("sidebar-mobile-open"),n.classList.remove("hidden")}),n.addEventListener("click",a),document.addEventListener("keydown",e=>{"Escape"===e.key&&a()}),t.addEventListener("click",e=>{t.classList.contains("sidebar-mobile-open")&&e.stopPropagation()}))}window.location.pathname.includes("timeline.html")?s(o,"timeline.json",!0):s(e=>e,"achievements.json"),fetch("assets/sidebar.html").then(e=>{if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return e.text()}).then(e=>{let t=document.getElementById("sidebar");if(t){t.innerHTML=e;let n=t.querySelectorAll(".sidebar-link.active");n.forEach(e=>e.classList.remove("active")),requestAnimationFrame(()=>{c(),h()})}}).catch(e=>{console.error("Error loading sidebar:",e)}),m(),window.addEventListener("pageshow",e=>{e.persisted&&(m(),c())}),window.addEventListener("pagehide",e=>{});let p=window.location.pathname;if(p.startsWith("/achievement/")){let u=decodeURIComponent(p.split("/achievement/")[1].toLowerCase());fetch("achievements.json").then(e=>e.json()).then(e=>{let t=e.find(e=>e.id&&e.id.toLowerCase()===u);if(t)v(t);else{let n=document.getElementById("achievement-details")||document.querySelector(".main-content");n&&(n.innerHTML=`
                        <div class="not-found">
                            <h2>Achievement Not Found</h2>
                            <p>We couldn't find an achievement with the ID: <strong>${u}</strong></p>
                            <a href="/" class="btn btn-primary">Return to Home</a>
                        </div>
                    `)}}).catch(e=>{console.error("Failed to load achievements.json:",e);let t=document.getElementById("achievement-details")||document.querySelector(".main-content");t&&(t.innerHTML=`
                    <div class="error">
                        <h2>Error Loading Achievement</h2>
                        <p>There was a problem loading the achievement data.</p>
                        <a href="/" class="btn btn-secondary">Back to Home</a>
                    </div>
                `)})}function v(e){let t=document.querySelector(".main-content"),n=document.getElementById("achievement-details");n?n.innerHTML="":((n=document.createElement("section")).id="achievement-details",n.className="achievement-details-container",t.innerHTML="",t.appendChild(n));let a=document.createElement("div");a.classList.add("single-achievement-wrapper");let r=i(e,0,!1,[e]);a.appendChild(r),n.appendChild(a);let s=e.thumbnail||(e.levelID?`https://tjcsucht.net/levelthumbs/${e.levelID}.png`:"default-thumbnail.png");l(s),document.title=`${e.name} - The Hardest Achievements List`,document.getElementById("meta-description").setAttribute("content",`Details about the achievement "${e.name}" by ${e.player}`)}});
